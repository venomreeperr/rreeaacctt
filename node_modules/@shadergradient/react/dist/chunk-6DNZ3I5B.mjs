import{a as mt}from"./chunk-YIJC6OD2.mjs";import{a as it,c as dt}from"./chunk-7RJG5BRD.mjs";var P={LEFT:1,RIGHT:2,MIDDLE:4},i=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,OFFSET:4,DOLLY:8,ZOOM:16,TOUCH_ROTATE:32,TOUCH_TRUCK:64,TOUCH_OFFSET:128,TOUCH_DOLLY:256,TOUCH_ZOOM:512,TOUCH_DOLLY_TRUCK:1024,TOUCH_DOLLY_OFFSET:2048,TOUCH_DOLLY_ROTATE:4096,TOUCH_ZOOM_TRUCK:8192,TOUCH_ZOOM_OFFSET:16384,TOUCH_ZOOM_ROTATE:32768}),N={NONE:0,IN:1,OUT:-1};function k(u){return u.isPerspectiveCamera}function H(u){return u.isOrthographicCamera}var Z=Math.PI*2,pt=Math.PI/2,Ct=1e-5,K=Math.PI/180;function M(u,t,e){return Math.max(t,Math.min(e,u))}function D(u,t=Ct){return Math.abs(u)<t}function x(u,t,e=Ct){return D(u-t,e)}function ut(u,t){return Math.round(u/t)*t}function X(u){return isFinite(u)?u:u<0?-Number.MAX_VALUE:Number.MAX_VALUE}function Q(u){return Math.abs(u)<Number.MAX_VALUE?u:u*(1/0)}function J(u,t,e,s,n=1/0,r){s=Math.max(1e-4,s);let a=2/s,l=a*r,m=1/(1+l+.48*l*l+.235*l*l*l),h=u-t,v=t,g=n*s;h=M(h,-g,g),t=u-h;let C=(e.value+a*h)*r;e.value=(e.value-a*C)*m;let f=t+(h+C)*m;return v-u>0==f>v&&(f=v,e.value=(f-v)/r),f}function ft(u,t,e,s,n=1/0,r,a){s=Math.max(1e-4,s);let l=2/s,m=l*r,h=1/(1+m+.48*m*m+.235*m*m*m),v=t.x,g=t.y,C=t.z,f=u.x-v,L=u.y-g,T=u.z-C,A=v,o=g,c=C,d=n*s,_=d*d,E=f*f+L*L+T*T;if(E>_){let st=Math.sqrt(E);f=f/st*d,L=L/st*d,T=T/st*d}v=u.x-f,g=u.y-L,C=u.z-T;let O=(e.x+l*f)*r,S=(e.y+l*L)*r,z=(e.z+l*T)*r;e.x=(e.x-l*O)*h,e.y=(e.y-l*S)*h,e.z=(e.z-l*z)*h,a.x=v+(f+O)*h,a.y=g+(L+S)*h,a.z=C+(T+z)*h;let j=A-u.x,W=o-u.y,vt=c-u.z,xt=a.x-A,Dt=a.y-o,Lt=a.z-c;return j*xt+W*Dt+vt*Lt>0&&(a.x=A,a.y=o,a.z=c,e.x=(a.x-A)/r,e.y=(a.y-o)/r,e.z=(a.z-c)/r),a}function ot(u,t){t.set(0,0),u.forEach(e=>{t.x+=e.clientX,t.y+=e.clientY}),t.x/=u.length,t.y/=u.length}function rt(u,t){return H(u)?(console.warn(`${t} is not supported in OrthographicCamera`),!0):!1}var _t=class{constructor(){this._listeners={}}addEventListener(t,e){let s=this._listeners;s[t]===void 0&&(s[t]=[]),s[t].indexOf(e)===-1&&s[t].push(e)}hasEventListener(t,e){let s=this._listeners;return s[t]!==void 0&&s[t].indexOf(e)!==-1}removeEventListener(t,e){let n=this._listeners[t];if(n!==void 0){let r=n.indexOf(e);r!==-1&&n.splice(r,1)}}removeAllEventListeners(t){if(!t){this._listeners={};return}Array.isArray(this._listeners[t])&&(this._listeners[t].length=0)}dispatchEvent(t){let s=this._listeners[t.type];if(s!==void 0){t.target=this;let n=s.slice(0);for(let r=0,a=n.length;r<a;r++)n[r].call(this,t)}}},nt,At="2.9.0",$=1/8,St=/Mac/.test((nt=globalThis==null?void 0:globalThis.navigator)===null||nt===void 0?void 0:nt.platform),p,gt,tt,at,F,y,U,V,q,I,b,Y,Ot,yt,R,G,B,Tt,ht,Et,lt,ct,et,w=class u extends _t{static install(t){p=t.THREE,gt=Object.freeze(new p.Vector3(0,0,0)),tt=Object.freeze(new p.Vector3(0,1,0)),at=Object.freeze(new p.Vector3(0,0,1)),F=new p.Vector2,y=new p.Vector3,U=new p.Vector3,V=new p.Vector3,q=new p.Vector3,I=new p.Vector3,b=new p.Vector3,Y=new p.Vector3,Ot=new p.Vector3,yt=new p.Vector3,R=new p.Spherical,G=new p.Spherical,B=new p.Box3,Tt=new p.Box3,ht=new p.Sphere,Et=new p.Quaternion,lt=new p.Quaternion,ct=new p.Matrix4,et=new p.Raycaster}static get ACTION(){return i}constructor(t,e){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.verticalDragToForward=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=i.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=N.NONE,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new p.Vector3,this._focalOffsetVelocity=new p.Vector3,this._zoomVelocity={value:0},this._truckInternal=(o,c,d)=>{let _,E;if(k(this._camera)){let O=y.copy(this._camera.position).sub(this._target),S=this._camera.getEffectiveFOV()*K,z=O.length()*Math.tan(S*.5);_=this.truckSpeed*o*z/this._elementRect.height,E=this.truckSpeed*c*z/this._elementRect.height}else if(H(this._camera)){let O=this._camera;_=o*(O.right-O.left)/O.zoom/this._elementRect.width,E=c*(O.top-O.bottom)/O.zoom/this._elementRect.height}else return;this.verticalDragToForward?(d?this.setFocalOffset(this._focalOffsetEnd.x+_,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(_,0,!0),this.forward(-E,!0)):d?this.setFocalOffset(this._focalOffsetEnd.x+_,this._focalOffsetEnd.y+E,this._focalOffsetEnd.z,!0):this.truck(_,E,!0)},this._rotateInternal=(o,c)=>{let d=Z*this.azimuthRotateSpeed*o/this._elementRect.height,_=Z*this.polarRotateSpeed*c/this._elementRect.height;this.rotate(d,_,!0)},this._dollyInternal=(o,c,d)=>{let _=Math.pow(.95,-o*this.dollySpeed),E=this._sphericalEnd.radius,O=this._sphericalEnd.radius*_,S=M(O,this.minDistance,this.maxDistance),z=S-O;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(O,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(z,!0),this._dollyToNoClamp(S,!0)):this._dollyToNoClamp(S,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?O:S)-E,this._dollyControlCoord.set(c,d)),this._lastDollyDirection=Math.sign(-o)},this._zoomInternal=(o,c,d)=>{let _=Math.pow(.95,o*this.dollySpeed),E=this._zoom,O=this._zoom*_;this.zoomTo(O,!0),this.dollyToCursor&&(this._changedZoom+=O-E,this._dollyControlCoord.set(c,d))},typeof p=="undefined"&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=t,this._yAxisUpSpace=new p.Quaternion().setFromUnitVectors(this._camera.up,tt),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=i.NONE,this._target=new p.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new p.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new p.Spherical().setFromVector3(y.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new p.Vector3,new p.Vector3,new p.Vector3,new p.Vector3],this._updateNearPlaneCorners(),this._boundary=new p.Box3(new p.Vector3(-1/0,-1/0,-1/0),new p.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new p.Vector2,this.mouseButtons={left:i.ROTATE,middle:i.DOLLY,right:i.TRUCK,wheel:k(this._camera)?i.DOLLY:H(this._camera)?i.ZOOM:i.NONE},this.touches={one:i.TOUCH_ROTATE,two:k(this._camera)?i.TOUCH_DOLLY_TRUCK:H(this._camera)?i.TOUCH_ZOOM_TRUCK:i.NONE,three:i.TOUCH_TRUCK};let s=new p.Vector2,n=new p.Vector2,r=new p.Vector2,a=o=>{if(!this._enabled||!this._domElement)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){let _=this._domElement.getBoundingClientRect(),E=o.clientX/_.width,O=o.clientY/_.height;if(E<this._interactiveArea.left||E>this._interactiveArea.right||O<this._interactiveArea.top||O>this._interactiveArea.bottom)return}let c=o.pointerType!=="mouse"?null:(o.buttons&P.LEFT)===P.LEFT?P.LEFT:(o.buttons&P.MIDDLE)===P.MIDDLE?P.MIDDLE:(o.buttons&P.RIGHT)===P.RIGHT?P.RIGHT:null;if(c!==null){let _=this._findPointerByMouseButton(c);_&&this._disposePointer(_)}if((o.buttons&P.LEFT)===P.LEFT&&this._lockedPointer)return;let d={pointerId:o.pointerId,clientX:o.clientX,clientY:o.clientY,deltaX:0,deltaY:0,mouseButton:c};this._activePointers.push(d),this._domElement.ownerDocument.removeEventListener("pointermove",l,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",m),this._domElement.ownerDocument.addEventListener("pointermove",l,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",m),this._isDragging=!0,C(o)},l=o=>{o.cancelable&&o.preventDefault();let c=o.pointerId,d=this._lockedPointer||this._findPointerById(c);if(d){if(d.clientX=o.clientX,d.clientY=o.clientY,d.deltaX=o.movementX,d.deltaY=o.movementY,this._state=0,o.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(o.buttons&P.LEFT)===P.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(o.buttons&P.MIDDLE)===P.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(o.buttons&P.RIGHT)===P.RIGHT&&(this._state=this._state|this.mouseButtons.right);f()}},m=o=>{let c=this._findPointerById(o.pointerId);if(!(c&&c===this._lockedPointer)){if(c&&this._disposePointer(c),o.pointerType==="touch")switch(this._activePointers.length){case 0:this._state=i.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else this._state=i.NONE;L()}},h=-1,v=o=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===i.NONE)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){let O=this._domElement.getBoundingClientRect(),S=o.clientX/O.width,z=o.clientY/O.height;if(S<this._interactiveArea.left||S>this._interactiveArea.right||z<this._interactiveArea.top||z>this._interactiveArea.bottom)return}if(o.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===i.ROTATE||this.mouseButtons.wheel===i.TRUCK){let O=performance.now();h-O<1e3&&this._getClientRect(this._elementRect),h=O}let c=St?-1:-3,d=o.deltaMode===1?o.deltaY/c:o.deltaY/(c*10),_=this.dollyToCursor?(o.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,E=this.dollyToCursor?(o.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case i.ROTATE:{this._rotateInternal(o.deltaX,o.deltaY),this._isUserControllingRotate=!0;break}case i.TRUCK:{this._truckInternal(o.deltaX,o.deltaY,!1),this._isUserControllingTruck=!0;break}case i.OFFSET:{this._truckInternal(o.deltaX,o.deltaY,!0),this._isUserControllingOffset=!0;break}case i.DOLLY:{this._dollyInternal(-d,_,E),this._isUserControllingDolly=!0;break}case i.ZOOM:{this._zoomInternal(-d,_,E),this._isUserControllingZoom=!0;break}}this.dispatchEvent({type:"control"})},g=o=>{if(!(!this._domElement||!this._enabled)){if(this.mouseButtons.right===u.ACTION.NONE){let c=o instanceof PointerEvent?o.pointerId:0,d=this._findPointerById(c);d&&this._disposePointer(d),this._domElement.ownerDocument.removeEventListener("pointermove",l,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",m);return}o.preventDefault()}},C=o=>{if(!this._enabled)return;if(ot(this._activePointers,F),this._getClientRect(this._elementRect),s.copy(F),n.copy(F),this._activePointers.length>=2){let d=F.x-this._activePointers[1].clientX,_=F.y-this._activePointers[1].clientY,E=Math.sqrt(d*d+_*_);r.set(0,E);let O=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,S=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;n.set(O,S)}if(this._state=0,!o)this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);else if("pointerType"in o&&o.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else!this._lockedPointer&&(o.buttons&P.LEFT)===P.LEFT&&(this._state=this._state|this.mouseButtons.left),(o.buttons&P.MIDDLE)===P.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(o.buttons&P.RIGHT)===P.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&i.ROTATE)===i.ROTATE||(this._state&i.TOUCH_ROTATE)===i.TOUCH_ROTATE||(this._state&i.TOUCH_DOLLY_ROTATE)===i.TOUCH_DOLLY_ROTATE||(this._state&i.TOUCH_ZOOM_ROTATE)===i.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&i.TRUCK)===i.TRUCK||(this._state&i.TOUCH_TRUCK)===i.TOUCH_TRUCK||(this._state&i.TOUCH_DOLLY_TRUCK)===i.TOUCH_DOLLY_TRUCK||(this._state&i.TOUCH_ZOOM_TRUCK)===i.TOUCH_ZOOM_TRUCK)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&i.DOLLY)===i.DOLLY||(this._state&i.TOUCH_DOLLY)===i.TOUCH_DOLLY||(this._state&i.TOUCH_DOLLY_TRUCK)===i.TOUCH_DOLLY_TRUCK||(this._state&i.TOUCH_DOLLY_OFFSET)===i.TOUCH_DOLLY_OFFSET||(this._state&i.TOUCH_DOLLY_ROTATE)===i.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&i.ZOOM)===i.ZOOM||(this._state&i.TOUCH_ZOOM)===i.TOUCH_ZOOM||(this._state&i.TOUCH_ZOOM_TRUCK)===i.TOUCH_ZOOM_TRUCK||(this._state&i.TOUCH_ZOOM_OFFSET)===i.TOUCH_ZOOM_OFFSET||(this._state&i.TOUCH_ZOOM_ROTATE)===i.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&i.OFFSET)===i.OFFSET||(this._state&i.TOUCH_OFFSET)===i.TOUCH_OFFSET||(this._state&i.TOUCH_DOLLY_OFFSET)===i.TOUCH_DOLLY_OFFSET||(this._state&i.TOUCH_ZOOM_OFFSET)===i.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})},f=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,ot(this._activePointers,F);let c=this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,d=c?-c.deltaX:n.x-F.x,_=c?-c.deltaY:n.y-F.y;if(n.copy(F),((this._state&i.ROTATE)===i.ROTATE||(this._state&i.TOUCH_ROTATE)===i.TOUCH_ROTATE||(this._state&i.TOUCH_DOLLY_ROTATE)===i.TOUCH_DOLLY_ROTATE||(this._state&i.TOUCH_ZOOM_ROTATE)===i.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(d,_),this._isUserControllingRotate=!0),(this._state&i.DOLLY)===i.DOLLY||(this._state&i.ZOOM)===i.ZOOM){let E=this.dollyToCursor?(s.x-this._elementRect.x)/this._elementRect.width*2-1:0,O=this.dollyToCursor?(s.y-this._elementRect.y)/this._elementRect.height*-2+1:0,S=this.dollyDragInverted?-1:1;(this._state&i.DOLLY)===i.DOLLY?(this._dollyInternal(S*_*$,E,O),this._isUserControllingDolly=!0):(this._zoomInternal(S*_*$,E,O),this._isUserControllingZoom=!0)}if((this._state&i.TOUCH_DOLLY)===i.TOUCH_DOLLY||(this._state&i.TOUCH_ZOOM)===i.TOUCH_ZOOM||(this._state&i.TOUCH_DOLLY_TRUCK)===i.TOUCH_DOLLY_TRUCK||(this._state&i.TOUCH_ZOOM_TRUCK)===i.TOUCH_ZOOM_TRUCK||(this._state&i.TOUCH_DOLLY_OFFSET)===i.TOUCH_DOLLY_OFFSET||(this._state&i.TOUCH_ZOOM_OFFSET)===i.TOUCH_ZOOM_OFFSET||(this._state&i.TOUCH_DOLLY_ROTATE)===i.TOUCH_DOLLY_ROTATE||(this._state&i.TOUCH_ZOOM_ROTATE)===i.TOUCH_ZOOM_ROTATE){let E=F.x-this._activePointers[1].clientX,O=F.y-this._activePointers[1].clientY,S=Math.sqrt(E*E+O*O),z=r.y-S;r.set(0,S);let j=this.dollyToCursor?(n.x-this._elementRect.x)/this._elementRect.width*2-1:0,W=this.dollyToCursor?(n.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&i.TOUCH_DOLLY)===i.TOUCH_DOLLY||(this._state&i.TOUCH_DOLLY_ROTATE)===i.TOUCH_DOLLY_ROTATE||(this._state&i.TOUCH_DOLLY_TRUCK)===i.TOUCH_DOLLY_TRUCK||(this._state&i.TOUCH_DOLLY_OFFSET)===i.TOUCH_DOLLY_OFFSET?(this._dollyInternal(z*$,j,W),this._isUserControllingDolly=!0):(this._zoomInternal(z*$,j,W),this._isUserControllingZoom=!0)}((this._state&i.TRUCK)===i.TRUCK||(this._state&i.TOUCH_TRUCK)===i.TOUCH_TRUCK||(this._state&i.TOUCH_DOLLY_TRUCK)===i.TOUCH_DOLLY_TRUCK||(this._state&i.TOUCH_ZOOM_TRUCK)===i.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(d,_,!1),this._isUserControllingTruck=!0),((this._state&i.OFFSET)===i.OFFSET||(this._state&i.TOUCH_OFFSET)===i.TOUCH_OFFSET||(this._state&i.TOUCH_DOLLY_OFFSET)===i.TOUCH_DOLLY_OFFSET||(this._state&i.TOUCH_ZOOM_OFFSET)===i.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(d,_,!0),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},L=()=>{ot(this._activePointers,F),n.copy(F),this._dragNeedsUpdate=!1,(this._activePointers.length===0||this._activePointers.length===1&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),this._activePointers.length===0&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",l,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",m),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{!this._enabled||!this._domElement||(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",l,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",m),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",T),this._domElement.ownerDocument.addEventListener("pointerlockerror",A),this._domElement.ownerDocument.addEventListener("pointermove",l,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",m),C())},this.unlockPointer=()=>{var o,c,d;this._lockedPointer!==null&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),(o=this._domElement)===null||o===void 0||o.ownerDocument.exitPointerLock(),(c=this._domElement)===null||c===void 0||c.ownerDocument.removeEventListener("pointerlockchange",T),(d=this._domElement)===null||d===void 0||d.ownerDocument.removeEventListener("pointerlockerror",A),this.cancel()};let T=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},A=()=>{this.unlockPointer()};this._addAllEventListeners=o=>{this._domElement=o,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",a),this._domElement.addEventListener("pointercancel",m),this._domElement.addEventListener("wheel",v,{passive:!1}),this._domElement.addEventListener("contextmenu",g)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",a),this._domElement.removeEventListener("pointercancel",m),this._domElement.removeEventListener("wheel",v,{passive:!1}),this._domElement.removeEventListener("contextmenu",g),this._domElement.ownerDocument.removeEventListener("pointermove",l,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",m),this._domElement.ownerDocument.removeEventListener("pointerlockchange",T),this._domElement.ownerDocument.removeEventListener("pointerlockerror",A))},this.cancel=()=>{this._state!==i.NONE&&(this._state=i.NONE,this._activePointers.length=0,L())},e&&this.connect(e),this.update(0)}get camera(){return this._camera}set camera(t){this._camera=t,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._domElement&&(t?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(t){this._spherical.radius===t&&this._sphericalEnd.radius===t||(this._spherical.radius=t,this._sphericalEnd.radius=t,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(t){this._spherical.theta===t&&this._sphericalEnd.theta===t||(this._spherical.theta=t,this._sphericalEnd.theta=t,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(t){this._spherical.phi===t&&this._sphericalEnd.phi===t||(this._spherical.phi=t,this._sphericalEnd.phi=t,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(t){this._boundaryEnclosesCamera=t,this._needsUpdate=!0}set interactiveArea(t){this._interactiveArea.width=M(t.width,0,1),this._interactiveArea.height=M(t.height,0,1),this._interactiveArea.x=M(t.x,0,1-this._interactiveArea.width),this._interactiveArea.y=M(t.y,0,1-this._interactiveArea.height)}addEventListener(t,e){super.addEventListener(t,e)}removeEventListener(t,e){super.removeEventListener(t,e)}rotate(t,e,s=!1){return this.rotateTo(this._sphericalEnd.theta+t,this._sphericalEnd.phi+e,s)}rotateAzimuthTo(t,e=!1){return this.rotateTo(t,this._sphericalEnd.phi,e)}rotatePolarTo(t,e=!1){return this.rotateTo(this._sphericalEnd.theta,t,e)}rotateTo(t,e,s=!1){this._isUserControllingRotate=!1;let n=M(t,this.minAzimuthAngle,this.maxAzimuthAngle),r=M(e,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=n,this._sphericalEnd.phi=r,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,s||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);let a=!s||x(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&x(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(a)}dolly(t,e=!1){return this.dollyTo(this._sphericalEnd.radius-t,e)}dollyTo(t,e=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=N.NONE,this._changedDolly=0,this._dollyToNoClamp(M(t,this.minDistance,this.maxDistance),e)}_dollyToNoClamp(t,e=!1){let s=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){let a=this._collisionTest(),l=x(a,this._spherical.radius);if(!(s>t)&&l)return Promise.resolve();this._sphericalEnd.radius=Math.min(t,a)}else this._sphericalEnd.radius=t;this._needsUpdate=!0,e||(this._spherical.radius=this._sphericalEnd.radius);let r=!e||x(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(r)}dollyInFixed(t,e=!1){this._targetEnd.add(this._getCameraDirection(q).multiplyScalar(t)),e||this._target.copy(this._targetEnd);let s=!e||x(this._target.x,this._targetEnd.x,this.restThreshold)&&x(this._target.y,this._targetEnd.y,this.restThreshold)&&x(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(s)}zoom(t,e=!1){return this.zoomTo(this._zoomEnd+t,e)}zoomTo(t,e=!1){this._isUserControllingZoom=!1,this._zoomEnd=M(t,this.minZoom,this.maxZoom),this._needsUpdate=!0,e||(this._zoom=this._zoomEnd);let s=!e||x(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(s)}pan(t,e,s=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(t,e,s)}truck(t,e,s=!1){this._camera.updateMatrix(),I.setFromMatrixColumn(this._camera.matrix,0),b.setFromMatrixColumn(this._camera.matrix,1),I.multiplyScalar(t),b.multiplyScalar(-e);let n=y.copy(I).add(b),r=U.copy(this._targetEnd).add(n);return this.moveTo(r.x,r.y,r.z,s)}forward(t,e=!1){y.setFromMatrixColumn(this._camera.matrix,0),y.crossVectors(this._camera.up,y),y.multiplyScalar(t);let s=U.copy(this._targetEnd).add(y);return this.moveTo(s.x,s.y,s.z,e)}elevate(t,e=!1){return y.copy(this._camera.up).multiplyScalar(t),this.moveTo(this._targetEnd.x+y.x,this._targetEnd.y+y.y,this._targetEnd.z+y.z,e)}moveTo(t,e,s,n=!1){this._isUserControllingTruck=!1;let r=y.set(t,e,s).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,r,this.boundaryFriction),this._needsUpdate=!0,n||this._target.copy(this._targetEnd);let a=!n||x(this._target.x,this._targetEnd.x,this.restThreshold)&&x(this._target.y,this._targetEnd.y,this.restThreshold)&&x(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(a)}lookInDirectionOf(t,e,s,n=!1){let l=y.set(t,e,s).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius).add(this._targetEnd);return this.setPosition(l.x,l.y,l.z,n)}fitToBox(t,e,{cover:s=!1,paddingLeft:n=0,paddingRight:r=0,paddingBottom:a=0,paddingTop:l=0}={}){let m=[],h=t.isBox3?B.copy(t):B.setFromObject(t);h.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());let v=ut(this._sphericalEnd.theta,pt),g=ut(this._sphericalEnd.phi,pt);m.push(this.rotateTo(v,g,e));let C=y.setFromSpherical(this._sphericalEnd).normalize(),f=Et.setFromUnitVectors(C,at),L=x(Math.abs(C.y),1);L&&f.multiply(lt.setFromAxisAngle(tt,v)),f.multiply(this._yAxisUpSpaceInverse);let T=Tt.makeEmpty();U.copy(h.min).applyQuaternion(f),T.expandByPoint(U),U.copy(h.min).setX(h.max.x).applyQuaternion(f),T.expandByPoint(U),U.copy(h.min).setY(h.max.y).applyQuaternion(f),T.expandByPoint(U),U.copy(h.max).setZ(h.min.z).applyQuaternion(f),T.expandByPoint(U),U.copy(h.min).setZ(h.max.z).applyQuaternion(f),T.expandByPoint(U),U.copy(h.max).setY(h.min.y).applyQuaternion(f),T.expandByPoint(U),U.copy(h.max).setX(h.min.x).applyQuaternion(f),T.expandByPoint(U),U.copy(h.max).applyQuaternion(f),T.expandByPoint(U),T.min.x-=n,T.min.y-=a,T.max.x+=r,T.max.y+=l,f.setFromUnitVectors(at,C),L&&f.premultiply(lt.invert()),f.premultiply(this._yAxisUpSpace);let A=T.getSize(y),o=T.getCenter(U).applyQuaternion(f);if(k(this._camera)){let c=this.getDistanceToFitBox(A.x,A.y,A.z,s);m.push(this.moveTo(o.x,o.y,o.z,e)),m.push(this.dollyTo(c,e)),m.push(this.setFocalOffset(0,0,0,e))}else if(H(this._camera)){let c=this._camera,d=c.right-c.left,_=c.top-c.bottom,E=s?Math.max(d/A.x,_/A.y):Math.min(d/A.x,_/A.y);m.push(this.moveTo(o.x,o.y,o.z,e)),m.push(this.zoomTo(E,e)),m.push(this.setFocalOffset(0,0,0,e))}return Promise.all(m)}fitToSphere(t,e){let s=[],r="isObject3D"in t?u.createBoundingSphere(t,ht):ht.copy(t);if(s.push(this.moveTo(r.center.x,r.center.y,r.center.z,e)),k(this._camera)){let a=this.getDistanceToFitSphere(r.radius);s.push(this.dollyTo(a,e))}else if(H(this._camera)){let a=this._camera.right-this._camera.left,l=this._camera.top-this._camera.bottom,m=2*r.radius,h=Math.min(a/m,l/m);s.push(this.zoomTo(h,e))}return s.push(this.setFocalOffset(0,0,0,e)),Promise.all(s)}setLookAt(t,e,s,n,r,a,l=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=N.NONE,this._changedDolly=0;let m=U.set(n,r,a),h=y.set(t,e,s);this._targetEnd.copy(m),this._sphericalEnd.setFromVector3(h.sub(m).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,l||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));let v=!l||x(this._target.x,this._targetEnd.x,this.restThreshold)&&x(this._target.y,this._targetEnd.y,this.restThreshold)&&x(this._target.z,this._targetEnd.z,this.restThreshold)&&x(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&x(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&x(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(v)}lerpLookAt(t,e,s,n,r,a,l,m,h,v,g,C,f,L=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=N.NONE,this._changedDolly=0;let T=y.set(n,r,a),A=U.set(t,e,s);R.setFromVector3(A.sub(T).applyQuaternion(this._yAxisUpSpace));let o=V.set(v,g,C),c=U.set(l,m,h);G.setFromVector3(c.sub(o).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(T.lerp(o,f));let d=G.theta-R.theta,_=G.phi-R.phi,E=G.radius-R.radius;this._sphericalEnd.set(R.radius+E*f,R.phi+_*f,R.theta+d*f),this.normalizeRotations(),this._needsUpdate=!0,L||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));let O=!L||x(this._target.x,this._targetEnd.x,this.restThreshold)&&x(this._target.y,this._targetEnd.y,this.restThreshold)&&x(this._target.z,this._targetEnd.z,this.restThreshold)&&x(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&x(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&x(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(O)}setPosition(t,e,s,n=!1){return this.setLookAt(t,e,s,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,n)}setTarget(t,e,s,n=!1){let r=this.getPosition(y),a=this.setLookAt(r.x,r.y,r.z,t,e,s,n);return this._sphericalEnd.phi=M(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),a}setFocalOffset(t,e,s,n=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(t,e,s),this._needsUpdate=!0,n||this._focalOffset.copy(this._focalOffsetEnd);let r=!n||x(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&x(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&x(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(r)}setOrbitPoint(t,e,s){this._camera.updateMatrixWorld(),I.setFromMatrixColumn(this._camera.matrixWorldInverse,0),b.setFromMatrixColumn(this._camera.matrixWorldInverse,1),Y.setFromMatrixColumn(this._camera.matrixWorldInverse,2);let n=y.set(t,e,s),r=n.distanceTo(this._camera.position),a=n.sub(this._camera.position);I.multiplyScalar(a.x),b.multiplyScalar(a.y),Y.multiplyScalar(a.z),y.copy(I).add(b).add(Y),y.z=y.z+r,this.dollyTo(r,!1),this.setFocalOffset(-y.x,y.y,-y.z,!1),this.moveTo(t,e,s,!1)}setBoundary(t){if(!t){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(t),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(t,e,s,n){if(t===null){this._viewport=null;return}this._viewport=this._viewport||new p.Vector4,typeof t=="number"?this._viewport.set(t,e,s,n):this._viewport.copy(t)}getDistanceToFitBox(t,e,s,n=!1){if(rt(this._camera,"getDistanceToFitBox"))return this._spherical.radius;let r=t/e,a=this._camera.getEffectiveFOV()*K,l=this._camera.aspect;return((n?r>l:r<l)?e:t/l)*.5/Math.tan(a*.5)+s*.5}getDistanceToFitSphere(t){if(rt(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;let e=this._camera.getEffectiveFOV()*K,s=Math.atan(Math.tan(e*.5)*this._camera.aspect)*2,n=1<this._camera.aspect?e:s;return t/Math.sin(n*.5)}getTarget(t,e=!0){return(t&&t.isVector3?t:new p.Vector3).copy(e?this._targetEnd:this._target)}getPosition(t,e=!0){return(t&&t.isVector3?t:new p.Vector3).setFromSpherical(e?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(e?this._targetEnd:this._target)}getSpherical(t,e=!0){return(t||new p.Spherical).copy(e?this._sphericalEnd:this._spherical)}getFocalOffset(t,e=!0){return(t&&t.isVector3?t:new p.Vector3).copy(e?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%Z,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=Z),this._spherical.theta+=Z*Math.round((this._sphericalEnd.theta-this._spherical.theta)/Z)}stop(){this._focalOffset.copy(this._focalOffsetEnd),this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd),this._zoom=this._zoomEnd}reset(t=!1){if(!x(this._camera.up.x,this._cameraUp0.x)||!x(this._camera.up.y,this._cameraUp0.y)||!x(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);let s=this.getPosition(y);this.updateCameraUp(),this.setPosition(s.x,s.y,s.z)}let e=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,t),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,t),this.zoomTo(this._zoom0,t)];return Promise.all(e)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,tt),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){let t=y.subVectors(this._target,this._camera.position).normalize(),e=U.crossVectors(t,this._camera.up);this._camera.up.crossVectors(e,t).normalize(),this._camera.updateMatrixWorld();let s=this.getPosition(y);this.updateCameraUp(),this.setPosition(s.x,s.y,s.z)}update(t){let e=this._sphericalEnd.theta-this._spherical.theta,s=this._sphericalEnd.phi-this._spherical.phi,n=this._sphericalEnd.radius-this._spherical.radius,r=Ot.subVectors(this._targetEnd,this._target),a=yt.subVectors(this._focalOffsetEnd,this._focalOffset),l=this._zoomEnd-this._zoom;if(D(e))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{let g=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=J(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,g,1/0,t),this._needsUpdate=!0}if(D(s))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{let g=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=J(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,g,1/0,t),this._needsUpdate=!0}if(D(n))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{let g=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=J(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,g,this.maxSpeed,t),this._needsUpdate=!0}if(D(r.x)&&D(r.y)&&D(r.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{let g=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;ft(this._target,this._targetEnd,this._targetVelocity,g,this.maxSpeed,t,this._target),this._needsUpdate=!0}if(D(a.x)&&D(a.y)&&D(a.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{let g=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;ft(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,g,this.maxSpeed,t,this._focalOffset),this._needsUpdate=!0}if(D(l))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{let g=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=J(this._zoom,this._zoomEnd,this._zoomVelocity,g,1/0,t)}if(this.dollyToCursor){if(k(this._camera)&&this._changedDolly!==0){let g=this._spherical.radius-this._lastDistance,C=this._camera,f=this._getCameraDirection(q),L=y.copy(f).cross(C.up).normalize();L.lengthSq()===0&&(L.x=1);let T=U.crossVectors(L,f),A=this._sphericalEnd.radius*Math.tan(C.getEffectiveFOV()*K*.5),c=(this._sphericalEnd.radius-g-this._sphericalEnd.radius)/this._sphericalEnd.radius,d=V.copy(this._targetEnd).add(L.multiplyScalar(this._dollyControlCoord.x*A*C.aspect)).add(T.multiplyScalar(this._dollyControlCoord.y*A)),_=y.copy(this._targetEnd).lerp(d,c),E=this._lastDollyDirection===N.IN&&this._spherical.radius<=this.minDistance,O=this._lastDollyDirection===N.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(E||O)){this._sphericalEnd.radius-=g,this._spherical.radius-=g;let z=U.copy(f).multiplyScalar(-g);_.add(z)}this._boundary.clampPoint(_,_);let S=U.subVectors(_,this._targetEnd);this._targetEnd.copy(_),this._target.add(S),this._changedDolly-=g,D(this._changedDolly)&&(this._changedDolly=0)}else if(H(this._camera)&&this._changedZoom!==0){let g=this._zoom-this._lastZoom,C=this._camera,f=y.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(C.near+C.far)/(C.near-C.far)).unproject(C),L=U.set(0,0,-1).applyQuaternion(C.quaternion),T=V.copy(f).add(L.multiplyScalar(-f.dot(C.up))),o=-(this._zoom-g-this._zoom)/this._zoom,c=this._getCameraDirection(q),d=this._targetEnd.dot(c),_=y.copy(this._targetEnd).lerp(T,o),E=_.dot(c),O=c.multiplyScalar(E-d);_.sub(O),this._boundary.clampPoint(_,_);let S=U.subVectors(_,this._targetEnd);this._targetEnd.copy(_),this._target.add(S),this._changedZoom-=g,D(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;let m=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,m),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!D(this._focalOffset.x)||!D(this._focalOffset.y)||!D(this._focalOffset.z))&&(this._camera.updateMatrixWorld(),I.setFromMatrixColumn(this._camera.matrix,0),b.setFromMatrixColumn(this._camera.matrix,1),Y.setFromMatrixColumn(this._camera.matrix,2),I.multiplyScalar(this._focalOffset.x),b.multiplyScalar(-this._focalOffset.y),Y.multiplyScalar(this._focalOffset.z),y.copy(I).add(b).add(Y),this._camera.position.add(y)),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),y.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);let v=this._needsUpdate;return v&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):v?(this.dispatchEvent({type:"update"}),D(e,this.restThreshold)&&D(s,this.restThreshold)&&D(n,this.restThreshold)&&D(r.x,this.restThreshold)&&D(r.y,this.restThreshold)&&D(r.z,this.restThreshold)&&D(a.x,this.restThreshold)&&D(a.y,this.restThreshold)&&D(a.z,this.restThreshold)&&D(l,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!v&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=v,this._needsUpdate=!1,v}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:X(this.maxDistance),minZoom:this.minZoom,maxZoom:X(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:X(this.maxPolarAngle),minAzimuthAngle:X(this.minAzimuthAngle),maxAzimuthAngle:X(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,verticalDragToForward:this.verticalDragToForward,target:this._targetEnd.toArray(),position:y.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(t,e=!1){let s=JSON.parse(t);this.enabled=s.enabled,this.minDistance=s.minDistance,this.maxDistance=Q(s.maxDistance),this.minZoom=s.minZoom,this.maxZoom=Q(s.maxZoom),this.minPolarAngle=s.minPolarAngle,this.maxPolarAngle=Q(s.maxPolarAngle),this.minAzimuthAngle=Q(s.minAzimuthAngle),this.maxAzimuthAngle=Q(s.maxAzimuthAngle),this.smoothTime=s.smoothTime,this.draggingSmoothTime=s.draggingSmoothTime,this.dollySpeed=s.dollySpeed,this.truckSpeed=s.truckSpeed,this.dollyToCursor=s.dollyToCursor,this.verticalDragToForward=s.verticalDragToForward,this._target0.fromArray(s.target0),this._position0.fromArray(s.position0),this._zoom0=s.zoom0,this._focalOffset0.fromArray(s.focalOffset0),this.moveTo(s.target[0],s.target[1],s.target[2],e),R.setFromVector3(y.fromArray(s.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(R.theta,R.phi,e),this.dollyTo(R.radius,e),this.zoomTo(s.zoom,e),this.setFocalOffset(s.focalOffset[0],s.focalOffset[1],s.focalOffset[2],e),this._needsUpdate=!0}connect(t){if(this._domElement){console.warn("camera-controls is already connected.");return}t.setAttribute("data-camera-controls-version",At),this._addAllEventListeners(t),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(t){return t.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(t){return this._getTargetDirection(t).negate()}_findPointerById(t){return this._activePointers.find(e=>e.pointerId===t)}_findPointerByMouseButton(t){return this._activePointers.find(e=>e.mouseButton===t)}_disposePointer(t){this._activePointers.splice(this._activePointers.indexOf(t),1)}_encloseToBoundary(t,e,s){let n=e.lengthSq();if(n===0)return t;let r=U.copy(e).add(t),l=this._boundary.clampPoint(r,V).sub(r),m=l.lengthSq();if(m===0)return t.add(e);if(m===n)return t;if(s===0)return t.add(e).add(l);{let h=1+s*m/e.dot(l);return t.add(U.copy(e).multiplyScalar(h)).add(l.multiplyScalar(1-s))}}_updateNearPlaneCorners(){if(k(this._camera)){let t=this._camera,e=t.near,s=t.getEffectiveFOV()*K,n=Math.tan(s*.5)*e,r=n*t.aspect;this._nearPlaneCorners[0].set(-r,-n,0),this._nearPlaneCorners[1].set(r,-n,0),this._nearPlaneCorners[2].set(r,n,0),this._nearPlaneCorners[3].set(-r,n,0)}else if(H(this._camera)){let t=this._camera,e=1/t.zoom,s=t.left*e,n=t.right*e,r=t.top*e,a=t.bottom*e;this._nearPlaneCorners[0].set(s,r,0),this._nearPlaneCorners[1].set(n,r,0),this._nearPlaneCorners[2].set(n,a,0),this._nearPlaneCorners[3].set(s,a,0)}}_collisionTest(){let t=1/0;if(!(this.colliderMeshes.length>=1)||rt(this._camera,"_collisionTest"))return t;let s=this._getTargetDirection(q);ct.lookAt(gt,s,this._camera.up);for(let n=0;n<4;n++){let r=U.copy(this._nearPlaneCorners[n]);r.applyMatrix4(ct);let a=V.addVectors(this._target,r);et.set(a,s),et.far=this._spherical.radius+1;let l=et.intersectObjects(this.colliderMeshes);l.length!==0&&l[0].distance<t&&(t=l[0].distance)}return t}_getClientRect(t){if(!this._domElement)return;let e=this._domElement.getBoundingClientRect();return t.x=e.left,t.y=e.top,this._viewport?(t.x+=this._viewport.x,t.y+=e.height-this._viewport.w-this._viewport.y,t.width=this._viewport.z,t.height=this._viewport.w):(t.width=e.width,t.height=e.height),t}_createOnRestPromise(t){return t?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(e=>{let s=()=>{this.removeEventListener("rest",s),e()};this.addEventListener("rest",s)}))}_addAllEventListeners(t){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(t){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(t){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(t,e=new p.Sphere){let s=e,n=s.center;B.makeEmpty(),t.traverseVisible(a=>{a.isMesh&&B.expandByObject(a)}),B.getCenter(n);let r=0;return t.traverseVisible(a=>{if(!a.isMesh)return;let l=a,m=l.geometry.clone();m.applyMatrix4(l.matrixWorld);let v=m.attributes.position;for(let g=0,C=v.count;g<C;g++)y.fromBufferAttribute(v,g),r=Math.max(r,n.distanceToSquared(y))}),s.radius=Math.sqrt(r),s}};import*as Pt from"three";import{extend as zt,useThree as Ut}from"@react-three/fiber";import{useEffect as Ft,useState as wt}from"react";import{jsx as Rt}from"react/jsx-runtime";function Yt(e){var s=e,{smoothTime:u=.05}=s,t=dt(s,["smoothTime"]);w.install({THREE:Pt}),zt({CameraControls:w});let n=Ut(h=>h.camera),r=Ut(h=>h.gl),a=mt(t),[l,m]=wt(!1);return Ft(()=>{let h=a.current;if(!h)return;let{type:v,onCameraUpdate:g}=t||{};if(!g)return;let C=o=>Math.round(o*180/Math.PI),f=()=>({cAzimuthAngle:C(h.azimuthAngle),cPolarAngle:C(h.polarAngle)}),L=()=>{var c;let o={};if(v==="sphere"){let d=h==null?void 0:h.zoom;if(Number.isFinite(d))o.cameraZoom=Number(d.toFixed(2));else{let _=(c=h==null?void 0:h.camera)==null?void 0:c.zoom;Number.isFinite(_)&&(o.cameraZoom=Number(_.toFixed(2)))}}else Number.isFinite(h.distance)&&(o.cDistance=Number(h.distance.toFixed(2)));return o},T=()=>{m(!0)},A=()=>{m(!1),g(it(it({},f()),L()))};return h.addEventListener("controlstart",T),h.addEventListener("rest",A),()=>{h.removeEventListener("controlstart",T),h.removeEventListener("rest",A)}},[a,t]),Rt("cameraControls",{ref:a,args:[n,r.domElement],smoothTime:l?0:u,zoomSpeed:10,dollySpeed:5,maxDistance:1e3,restThreshold:.01,mouseButtons:{left:w.ACTION.ROTATE,middle:t.type==="sphere"?w.ACTION.ZOOM:w.ACTION.DOLLY,right:w.ACTION.NONE,wheel:t.type==="sphere"?w.ACTION.ZOOM:w.ACTION.DOLLY},touches:{one:w.ACTION.ROTATE,two:w.ACTION.NONE,three:w.ACTION.NONE}})}export{Yt as a};
/*! Bundled license information:

camera-controls/dist/camera-controls.module.js:
  (*!
   * camera-controls
   * https://github.com/yomotsu/camera-controls
   * (c) 2017 @yomotsu
   * Released under the MIT License.
   *)
*/
