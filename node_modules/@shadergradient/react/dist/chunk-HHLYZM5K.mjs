import{a as k}from"./chunk-OM36AWEE.mjs";import{a as H}from"./chunk-ST3I7JZX.mjs";import*as t from"react";import{createPortal as _,useFrame as j,useThree as c}from"@react-three/fiber";import{Matrix4 as B,Object3D as K,Quaternion as E,Scene as L,Vector3 as m}from"three";import{jsx as V,jsxs as $}from"react/jsx-runtime";var I=t.createContext({}),pt=()=>t.useContext(I),N=2*Math.PI,O=new K,q=new B,[a,b]=[new E,new E],S=new m,T=new m,Z=n=>"minPolarAngle"in n,lt=({alignment:n="bottom-right",margin:M=[80,80],renderPriority:W=0,autoClear:Q=!0,onUpdate:h,onTarget:s,children:A})=>{let i=c(({size:e})=>e),r=c(({camera:e})=>e),o=c(({controls:e})=>e),f=c(({gl:e})=>e),u=c(({scene:e})=>e),d=c(({invalidate:e})=>e),p=t.useRef(),C=t.useRef(),l=t.useRef(null),[R]=t.useState(()=>new L),y=t.useRef(!1),g=t.useRef(0),x=t.useRef(new m(0,0,0)),w=t.useRef(new m(0,0,0));t.useEffect(()=>{w.current.copy(r.up)},[r]);let P=t.useCallback(e=>{y.current=!0,(o||s)&&(x.current=(o==null?void 0:o.target)||(s==null?void 0:s())),g.current=r.position.distanceTo(S),a.copy(r.quaternion),T.copy(e).multiplyScalar(g.current).add(S),O.lookAt(T),b.copy(O.quaternion),d()},[o,r,s,d]);t.useEffect(()=>(u.background&&(p.current=u.background,u.background=null,R.background=p.current),()=>{p.current&&(u.background=p.current)}),[]),j((e,U)=>{var G;if(l.current&&C.current){if(y.current)if(a.angleTo(b)<.01)y.current=!1,Z(o)&&r.up.copy(w.current);else{let Y=U*N;a.rotateTowards(b,Y),r.position.set(0,0,1).applyQuaternion(a).multiplyScalar(g.current).add(x.current),r.up.set(0,1,0).applyQuaternion(a).normalize(),r.quaternion.copy(a),h?h():o&&o.update(),d()}q.copy(r.matrix).invert(),(G=C.current)==null||G.quaternion.setFromRotationMatrix(q),Q&&(f.autoClear=!1),f.clearDepth(),f.render(R,l.current)}},W);let D=k(l),F=t.useMemo(()=>({tweenCamera:P,raycast:D}),[P]),[z,v]=M,X=n.endsWith("-center")?0:n.endsWith("-left")?-i.width/2+z:i.width/2-z,J=n.startsWith("center-")?0:n.startsWith("top-")?i.height/2-v:-i.height/2+v;return _($(I.Provider,{value:F,children:[V(H,{ref:l,position:[0,0,200]}),V("group",{ref:C,position:[X,J,0],children:A})]}),R)};export{pt as a,lt as b};
